[supervisord]
nodaemon=true
user=root
logfile=/data/logs/bind/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/data/logs/bind
loglevel=debug

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

# BIND DNS server
[program:named]
command=/usr/sbin/named -g -u bind
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/data/logs/bind/general.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/data/logs/bind/general-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5
user=root
priority=100

# DKIM key monitor
[program:dkim-monitor]
command=/data/.venv/bin/python /data/src/dkim_manager.py --hot-reload
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/data/logs/bind/dkim-monitor.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/data/logs/bind/dkim-monitor-error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5
user=root
priority=200
environment=PATH="/data/.venv/bin:%(ENV_PATH)s"
# Don't start DKIM monitor until BIND is running
startsecs=10
startretries=3
exitcodes=0