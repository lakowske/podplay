# Fail2Ban filter for BIND DNS abuse
# Detects:
# - Excessive ANY queries
# - Case permutation attacks
# - Rapid query patterns
# - Short domain probes

[Definition]

# Option: failregex
# Notes: Matches DNS abuse patterns in BIND logs
# Values: TEXT
#
failregex = ^.*client.*#\d+\s+\(<HOST>\).*query:.*\sIN\s+ANY\s+.*$
            ^.*client.*#\d+\s+\(<HOST>\).*query:\s+\S{1,2}\s+IN\s+.*$
            ^.*client.*#\d+\s+\(<HOST>\).*query:.*[a-z]+[A-Z]+[a-z]+.*IN\s+.*$
            ^.*client.*#\d+\s+\(<HOST>\).*query:.*[A-Z]+[a-z]+[A-Z]+.*IN\s+.*$
            ^.*client.*#\d+\s+\(<HOST>\).*rate limit drop response.*$
            ^.*client.*#\d+\s+\(<HOST>\).*rate limit slip response.*$

# Option: ignoreregex
# Notes: Ignore legitimate queries
# Values: TEXT
#
ignoreregex = ^.*client.*(127\.0\.0\.1|::1)#.*$

# Author: PodPlay DNS Security